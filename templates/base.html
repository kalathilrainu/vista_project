{% load static core_extras %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %}Village Office Portal{% endblock %} | Govt of Kerala</title>

    <!-- Fonts: Inter for UI, Merriweather for headings -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Merriweather:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=3.4">
    {% block extra_css %}{% endblock %}

    <link rel="shortcut icon" href="{% static 'images/vista_logo.png' %}" type="image/png">
</head>


<!-- Main Header -->
<header class="main-header">
    <div class="container header-content">
        <a href="/" class="logo-area">
            <!-- VISTA Logo -->
            <img src="{% static 'images/vista_logo.png' %}" alt="VISTA Logo" class="vista-logo"
                data-fallback-src="{% static 'images/kerala_emblem.svg' %}" onerror="this.src=this.dataset.fallbackSrc">
            <div class="branding-text">
                <h1 class="site-title">Village Integrated Service & Transaction Application</h1>
                <span class="site-subtitle">Department of Revenue, Government of Kerala</span>
            </div>
        </a>

        <div class="header-right">
            <!-- Kerala Govt Logo (Prominent) -->
            <img src="{% static 'images/gov_kerala_logo.png' %}" alt="Government of Kerala" class="govt-logo-main"
                data-fallback-src="{% static 'images/kerala_emblem.svg' %}" onerror="this.src=this.dataset.fallbackSrc">
        </div>
    </div>
</header>

<!-- Navigation -->
<nav class="main-nav"
    style="background-color: var(--brand-dark); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 1.15rem 0;">
    <div class="container nav-content"
        style="display: flex; justify-content: space-between; align-items: center; max-width: 98%;">

        <!-- Left Side: VISTA v 1.0 -->
        <div class="nav-left" style="color: white; font-size: 1.5rem; font-weight: 700;">
            VISTA <span style="font-size: 1rem; opacity: 0.8; font-weight: 400;">v 1.0</span>
            <span
                style="font-family: 'Merriweather', serif; font-size: 1.6rem; margin-left: 17.5rem; font-style: italic; font-weight: 700; letter-spacing: 0.5px; opacity: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">Village
                Office Nattakam</span>
        </div>

        <!-- Right Side: User Info & Logout -->
        <div class="nav-right" style="display: flex; align-items: center; gap: 2rem; color: white;">
            {% if user.is_authenticated %}
            <div class="user-info" style="text-align: right; display: flex; align-items: center; gap: 1rem;">
                <span style="font-weight: 600; font-size: 1.1rem; text-transform: uppercase;">{{ user.username }}</span>
                <span class="text-white-50">|</span>
                <span style="font-weight: 500; font-size: 1rem;">
                    <i class="bi bi-person-fill me-1"></i>
                    {% get_active_staff_name user as staff_name %}
                    {{ staff_name|default:user.username }}
                </span>
            </div>

            <a href="{% url 'dashboard' %}" class="btn btn-outline-light btn-sm"
                style="border-width: 1px; font-weight: 500; padding: 0.4rem 1rem; border-radius: 4px;">
                <i class="bi bi-speedometer2 me-1"></i> Dashboard
            </a>

            <form action="{% url 'logout' %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-light btn-sm"
                    style="border-width: 1px; font-weight: 500; padding: 0.4rem 1rem; border-radius: 4px;">
                    <i class="bi bi-box-arrow-right me-1"></i> Logout
                </button>
            </form>
            {% else %}
            {% if request.path != '/' %}
            <a href="/#login" class="btn-login-nav">Login</a>
            {% endif %}
            {% endif %}
        </div>
    </div>
</nav>

<!-- Main Content -->
<main
    style="min-height: 80vh; background-color: {% if user.is_authenticated and not hide_sidebar %}#f3f4f6{% else %}var(--bg-body){% endif %}; padding-bottom: 2rem;">
    {% if messages %}
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1060;">
        {% for message in messages %}
        <div id="toast-{{ forloop.counter }}"
            class="toast align-items-center {% if message.tags == 'error' %}text-bg-danger border-0{% elif message.tags == 'success' %}text-bg-success border-0{% else %}text-bg-primary border-0{% endif %}"
            role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    {% if message.tags == 'success' %}
                        <i class="bi bi-check-circle-fill me-2"></i>
                    {% elif message.tags == 'error' %}
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    {% endif %}
                    {{ message }}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Layout Container -->
    <div class="{% if user.is_authenticated and not hide_sidebar %}d-flex{% endif %}" style="width: 100%;">

        {% if user.is_authenticated and not hide_sidebar %}
        <!-- Sidebar -->
        <div class="sidebar-container d-none d-lg-block"
            style="width: 250px; min-width: 250px; margin: 1.5rem 0 1.5rem 1.5rem;">
            <div class="sidebar-card bg-white shadow-sm rounded overflow-hidden sticky-top" style="top: 100px;">
                <div class="sidebar-header p-3 text-white" style="background-color: #2E7D32;">
                    <h5 class="m-0 fw-bold"><i class="bi bi-list me-2"></i>Menu</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="https://edistrict.kerala.gov.in" target="_blank"
                        class="list-group-item list-group-item-action py-3"><i
                            class="bi bi-globe me-2 text-success"></i> eDistrict</a>
                    <a href="https://revenue.kerala.gov.in/" target="_blank"
                        class="list-group-item list-group-item-action py-3"><i
                            class="bi bi-file-earmark-text me-2 text-success"></i> ReLIS</a>
                    <a href="https://evpn.kerala.gov.in/" target="_blank"
                        class="list-group-item list-group-item-action py-3"><i
                            class="bi bi-building me-2 text-success"></i> eOffice</a>
                    <a href="https://rr.kerala.gov.in/" target="_blank"
                        class="list-group-item list-group-item-action py-3"><i
                            class="bi bi-currency-rupee me-2 text-success"></i> RR Online</a>
                    <a href="https://cmo.kerala.gov.in" target="_blank"
                        class="list-group-item list-group-item-action py-3"><i
                            class="bi bi-people me-2 text-success"></i> CMO CMDRF</a>
                    <a href="http://lrd.kerala.gov.in" target="_blank"
                        class="list-group-item list-group-item-action py-3"><i
                            class="bi bi-geo-alt me-2 text-success"></i> LRD Portal</a>
                    <a href="https://landrevenue.kerala.gov.in/login_user" target="_blank"
                        class="list-group-item list-group-item-action py-3"><i
                            class="bi bi-house-door me-2 text-success"></i> Village Portal</a>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Content Area -->
        <div class="content-container {% if user.is_authenticated and not hide_sidebar %}flex-grow-1 p-4{% endif %}"
            style="width: 100%;">
            {% block content %}{% endblock %}


        </div>
    </div>
</main>

<!-- Footer -->
<footer class="main-footer">
    <div class="container footer-grid">
        <div class="footer-section">
            <h4>About VISTA</h4>
            <p>An initiative to modernize Village Offices across Kerala, ensuring transparent and efficient service
                delivery to citizens.</p>
        </div>
        <div class="footer-section">
            <h4>Important Links</h4>
            <ul>
                <li><a href="https://kerala.gov.in" target="_blank">Kerala Govt Portal</a></li>
                <li><a href="https://revenue.kerala.gov.in" target="_blank">Revenue Department</a></li>
                <li><a href="https://edistrict.kerala.gov.in" target="_blank">e-District</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Contact Info</h4>
            <p>Village Office, Nattakam</p>
            <p>Kottayam, Kerala - 686013</p>
            <p>Email: vo-nattakam@kerala.gov.in</p>
        </div>
    </div>
    <div class="footer-bottom">
        <div class="container">
            <p>&copy; {% now "Y" %} Dept of Revenue, Govt of Kerala. All Rights Reserved.</p>
            <p class="credits">Powered by VISTA</p>
        </div>
    </div>
</footer>

<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/main.js' %}"></script>
{% block extra_js %}{% endblock %}
</body>

</html>